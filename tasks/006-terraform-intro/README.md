# Домашнее задание "Введение в Terraform"

### Чеклист готовности к домашнему заданию
> Приложите скриншот вывода команды `terraform --version`

```shell
$ terraform --version
Terraform v1.4.6
on linux_amd64
```

### Задание 1.
> Изучите файл .gitignore. В каком terraform файле согласно этому .gitignore
> допустимо сохранить личную, секретную информацию?

`personal.auto.tfvars`

> Выполните код проекта. Найдите в State-файле секретное содержимое созданного ресурса random_password, пришлите в качестве ответа конкретный ключ и его значение.
```shell
"result": "xYIQUS6NFMx6LAxp"
```

> Объясните в чем заключаются намеренно допущенные ошибки (**доработано**)?:

* в файле main.tf при описании ресурса docker_image пропущено обязательное поле: имя
* при описании ресурса docker_container в поле "имя" используется цифра в начале `1nginx`, это ошибка
* в сабституторе: ` "example_${random_password.random_string_fake.resuld}"` опечатка, `resuld` нет такого, есть `result`
* там же - `random_string_fake` не существует, есть только `random_string`

> Выполните код. В качестве ответа приложите вывод команды `docker ps`:

```shell
16:46 $ docker ps                                                                                                                    
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                  NAMES                   
16f6888b760f   f9c14fe76d50   "/docker-entrypoint.…"   5 seconds ago   Up 4 seconds   0.0.0.0:8000->80/tcp   example_rjmYLzGUvDb1Xz2G
```
> Замените имя docker-контейнера в блоке кода на hello_world,
> выполните команду terraform apply -auto-approve. Объясните своими словами,
> в чем может быть опасность применения ключа -auto-approve (**доработано**)?
> В качестве ответа дополнительно приложите вывод команды `docker ps`

```shell
17:42 $ docker ps                                                     
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
```
Раз вывод команды `docker ps` показал нам, что нет запущенного контейнера больше нет, то опасность видимо в том, что _Terraform_ может удалить ресурсы, а при этом новые не создать.  
Поэтому, лучше смотреть план перед применением конфигурации. Если более широко подходить к вопросу, то ключ `-auto-approve` для команды `terraform apply` отключает подтверждение изменений перед их применением, что может привести к непредвиденным последствиям. Если в конфигурационных файлах _Terraform_ были внесены изменения, которые могут привести к нежелательным результатам, то использование ключа `-auto-approve` может привести к их автоматическому применению без возможности отката. Это может привести к потере данных, нарушению работы системы или другим серьезным проблемам (что мы и увидели - контейнер не запущен). Поэтому использование ключа `-auto-approve` следует применять только в случаях, когда мы уверены в том, что изменения безопасны и не приведут к нежелательным последствиям. В большинстве случаев рекомендуется использовать команду terraform plan для предварительного просмотра изменений и проверки их безопасности перед применением.

> Уничтожьте созданные ресурсы с помощью terraform. Убедитесь, что все ресурсы удалены.
> Приложите содержимое файла terraform.tfstate:

```tf
{                                                   
  "version": 4,                                     
  "terraform_version": "1.4.6",                     
  "serial": 34,                                     
  "lineage": "<hidden>",
  "outputs": {},                                    
  "resources": [],                                  
  "check_results": null                             
}                                                   
```

> Объясните, почему при этом не был удален docker образ nginx:latest?
> Ответ подкрепите выдержкой из документации провайдера.

Из-за опции [keep_locally](https://registry.terraform.io/providers/kreuzwerker/docker/latest/docs/resources/image#keep_locally) не удалился докер имедж.  
Эта опция указывает на то, что при удалении ресурса docker_image терраформ не будет удалять скачанный с докер-реджистри имедж.
